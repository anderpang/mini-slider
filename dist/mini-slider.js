/*! <anderpang@foxmail.com> */
"use strict";(function(t,i){typeof module==="object"?(exports.__esModule=true,module.exports.default=i()):t.MiniSlider=i()})(this,function(){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,16.6667)},t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||function(t){clearTimeout(t)};function s(t){this.transitionClass="";this.index=0;this._listeners=[];this._framesCount=0;this._isTouch=false;this._timer=null;this._isVeritcal=false;this._isMove=false;this._value=0;this._ox=0;this._oy=0;this._owh=0;this._timeStamp=0;this._dir=1;this.evts={enter:function(){this.stop()},down:function(t){this._ox=this._isTouch?t.targetTouches[0].clientX:t.clientX;this._oy=this._isTouch?t.targetTouches[0].clientY:t.clientY;this._value=this._isVeritcal?this._oy:this._ox;this.inner.classList.remove(this.transitionClass);this._owh=this._isVeritcal?this.inner.clientHeight:this.inner.clientWidth;this._timeStamp=t.timeStamp;this._isMove=true;this.stop().resetIndex().move()},move:function(t){if(this._isMove){this._value=this._isVeritcal?this._isTouch?t.targetTouches[0].clientY:t.clientY:this._isTouch?t.targetTouches[0].clientX:t.clientX}},up:function(t){if(this._isMove){var i=(this._isTouch?t.changedTouches[0].clientX:t.clientX)-this._ox,s=(this._isTouch?t.changedTouches[0].clientY:t.clientY)-this._oy,e=i*i,n=s*s,o=this._isVeritcal?n:e,h=t.timeStamp-this._timeStamp<200&&o>25||o>2500,r=!h&&e<25&&n<25,a=this.index,l=this._isVeritcal?s>0?-1:1:i>0?-1:1;a=h?a+l:a;if(!this.options.loop){if(a<0){a=0}else if(a>this.len-1){a=this.len-1}}this.stop();this._isMove=false;this.inner.classList.add(this.transitionClass);this.inner.offsetHeight;this.index=a;this.translate(-a*100);if(!this.options.alwaysBackwards){this._dir=l}h?this._trigger("change"):r?this._trigger("click"):null}if(this.options.autoplay&&(this._isTouch||t.type==="mouseleave"||t.type==="pointerleave")){this.play()}}};var i,s;var e=Object.assign({delay:5e3,direction:"horizontal",alwaysBackwards:false,click:Function.prototype,change:Function.prototype},t);this.frames=e.delay*60/1e3|0;this.transitionClass=e.transitionClass||"is-anim";this.inner=e.el.firstElementChild;this.options=e;this._isVeritcal=e.direction==="vertical";i=this.inner.children;s=i.length;this.len=s;if(s>1){this.init(i,s)}}s.prototype.init=function(t,i){var s=this._isVeritcal?"top":"left";if(this.options.loop){var e=t[i-1].cloneNode(true),n=t[0].cloneNode(true);e.style[s]="-100%";n.style[s]=i+"00%";this.inner.appendChild(e);this.inner.appendChild(n)}while(i--){t[i].style[s]=i*100+"%"}if(this.options.index){this.index=this.options.index;this.translate(-100*this.index)}this.move=this.move.bind(this);this.initEvent(this.options.el);if(this.options.autoplay){this.play()}};s.prototype._bindEvents=function(t,i){var s=i.length;while(s--){t.addEventListener(i[s],this,false)}};s.prototype.initEvent=function(t){var i=typeof t.ontouchstart!=="undefined";var s=typeof t.onpointerdown!=="undefined";var e=this.evts;var n;this._isTouch=i;if(i){e.touchstart=e.down;e.touchmove=e.move;e.touchend=e.touchcancel=e.up;n=["touchstart","touchmove","touchend","touchcancel"]}else if(s){e.pointerenter=e.enter;e.pointerdown=e.down;e.pointermove=e.move;e.pointerup=e.pointerleave=e.up;n=["pointerenter","pointerdown","pointermove","pointerup","pointerleave"]}else{e.mouseenter=e.enter;e.mousedown=e.down;e.mousemove=e.move;e.mouseup=e.mouseleave=e.up;n=["mouseenter","mousedown","mousemove","mouseup","mouseleave"]}this._bindEvents(t,n);return this};s.prototype.resetIndex=function(){var t=this.index,i=this.len,s=false;if(t===-1){this.index+=i;s=true}else if(t===i){this.index=0;s=true}if(s){this.inner.classList.remove(this.transitionClass);this.translate(-this.index*100);this.inner.offsetHeight}return this};s.prototype.translate=function(t){this.inner.style.transform=this.inner.style.webkitTransform=this._isVeritcal?"translateY("+t+"%) translateZ(0)":"translateX("+t+"%) translateZ(0)";return this};s.prototype.move=function(){this._timer=i(this.move);if(this._isMove){var t=((this._value-(this._isVeritcal?this._oy:this._ox))*.8/this._owh-this.index)*100;this.translate(t)}else if(this.options.autoplay){if(this._framesCount++>this.frames){this._framesCount=0;this.resetIndex();this._dir<0?this._prev():this._next()}}return this};s.prototype.play=function(){this._isMove=false;return this.stop().move()};s.prototype.stop=function(){this._framesCount=0;t(this._timer);return this};s.prototype.prev=function(){if(!this.options.alwaysBackwards){this._dir=-1}this.stop().resetIndex()._prev();if(this.options.autoplay){this.play()}return this};s.prototype.next=function(){if(!this.options.alwaysBackwards){this._dir=1}this.stop().resetIndex()._next();if(this.options.autoplay){this.play()}return this};s.prototype._prev=function(){var t=this.index;if(--this.index<0){if(!this.options.loop){this.index=this.options.autoplay&&this.len>1?1:0;this._dir*=-1}}this.inner.classList.add(this.transitionClass);this.translate(-this.index*100);t!==this.index&&this._trigger("change")};s.prototype._next=function(){var t=this.index;if(++this.index===this.len){if(!this.options.loop){this.index=this.options.autoplay&&this.len>1?this.len-2:this.len-1;this._dir*=-1}}this.inner.classList.add(this.transitionClass);this.translate(-this.index*100);t!==this.index&&this._trigger("change");return this};s.prototype.handleEvent=function(t){var i=t.type;var s=this.evts;var e=s[i];e&&e.call(this,t)};s.prototype._trigger=function(t){var i=this.index,s=this.len,e=(i+s)%s;this.options[t](e,i);return this};return s});